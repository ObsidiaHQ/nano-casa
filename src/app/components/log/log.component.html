<div class="page-body mt-5">
    <div class="container-xl">
      <div class="card mb-3">
        <div class="card-header">
          <h3 class="card-title">Cron Logs</h3>
        </div>
        <div class="accordion" id="logAccordion">
            @for (run of shared.logs(); track run.id; let i = $index) {
              <div class="accordion-item">
                <h2 class="accordion-header" [id]="'heading' + i">
                  <button
                    class="accordion-button collapsed"
                    type="button"
                    data-bs-toggle="collapse"
                    [attr.data-bs-target]="'#collapse' + i"
                    aria-expanded="false"
                    [attr.aria-controls]="'collapse' + i"
                  >
                    <span class="mx-1 text-muted">{{ run.start_timestamp | date:'medium' }}</span>
                    <span class="mx-1">{{run.job_name}}</span>
                    <span class="badge mx-1 badge-outline"
                          [ngClass]="{
                            'text-green': run.status === 'success',
                            'text-red': run.status === 'failed',
                            'text-yellow': run.status === 'running',
                            'text-default': run.status !== 'success' && run.status !== 'failed' && run.status !== 'running'
                          }">{{run.status}}</span>
                    <span class="mx-1 text-muted"><strong>[{{run.duration_ms / 1000 | number:'1.0-2'}}s]</strong></span>
                  </button>
                </h2>
                <div
                  [id]="'collapse' + i"
                  class="accordion-collapse collapse"
                  [attr.aria-labelledby]="'heading' + i"
                  data-bs-parent="#logAccordion"
                >
                  <div class="accordion-body py-2">
                    @for (log of run.logs; track log.id) {
                        <p class="mb-1" [ngClass]="{
                            'text-yellow': log.level === 'warn',
                            'text-red': log.level === 'error'
                          }">
                          <span class="text-muted">{{log.timestamp | date:'mediumTime'}}</span> {{log.message}}
                          @if (log.duration_ms) {
                            <span class="text-muted">[{{log.duration_ms / 1000 | number:'1.0-2'}}ms]</span>
                          }
                        </p>
                      }
                  </div>
                </div>
              </div>
            } @empty {
              <p class="text-muted p-3">No job runs found.</p>
            }
        </div>
      </div>
    </div>
</div>

